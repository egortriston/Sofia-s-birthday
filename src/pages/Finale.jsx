import { useEffect, useState, useRef } from 'react'
import { Starfield } from '@/components/ui/starfield-1'
import './Finale.css'
import starWarsMusic from '@/music/John_Williams_-_Star_Wars_Main_Theme_and_Ambush_on_Coruscant_Zvezdnye_vojny_Ataka_klonov_(SkySound.cc).mp3'

function Finale() {
  const [showText, setShowText] = useState(false)
  const [musicPlaying, setMusicPlaying] = useState(false)
  const audioRef = useRef(null)

  useEffect(() => {
    setTimeout(() => setShowText(true), 1000)
    
    // –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç
    audioRef.current = new Audio(starWarsMusic)
    audioRef.current.loop = true
    audioRef.current.volume = 0.5

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const playPromise = audioRef.current.play()
    if (playPromise !== undefined) {
      playPromise
        .then(() => {
          setMusicPlaying(true)
        })
        .catch(error => {
          console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', error)
          // –ï—Å–ª–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –≤—Ä—É—á–Ω—É—é
        })
    }

    return () => {
      // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
      if (audioRef.current) {
        audioRef.current.pause()
        audioRef.current = null
      }
    }
  }, [])

  const handleMusicToggle = () => {
    if (!audioRef.current) return

    if (musicPlaying) {
      audioRef.current.pause()
      setMusicPlaying(false)
    } else {
      const playPromise = audioRef.current.play()
      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            setMusicPlaying(true)
          })
          .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error)
          })
      }
    }
  }

  const congratulationText = `
    –ê–•–ê–•–ê–•–ê–•–ê–•–ê–•–•–ê–•
    
    –° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è –µ—â–µ —Ä–∞–∑ —Ç–µ–±—è, –°–æ—à–∞!
    
    –¢—ã –ø—Ä–æ—à–ª–∞ —á–µ—Ä–µ–∑ –≤—Å–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –∫–æ—Å–º–æ—Å–∞,
    –æ—Ç–≤–µ—Ç–∏–ª–∞ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –¥–æ–∫–∞–∑–∞–ª–∞,
    —á—Ç–æ —Ç—ã –Ω–∞—Å—Ç–æ—è—â–∞—è –∑–≤–µ–∑–¥–∞!
    
    –Ø –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –ø–æ–º–Ω—é, —á—Ç–æ —Ç–≤–æ–π –ø–∞–ø–∞ —Ñ–∞–Ω–∞—Ç —Å–µ—Ä–∏–∏ –ó–≤–µ–∑–¥–Ω—ã—Ö –≤–æ–π–Ω, –ø–æ—ç—Ç–æ–º—É –¥—É–º–∞—é, —á—Ç–æ –≤–∞–º –∑–∞—à–ª–∞ —Ç–∞–∫–∞—è –æ—Ç—Å—ã–ª–∫–∞.
    
    –¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å –≤—Å–µ–≥–æ —Å–∞–º–æ–≥–æ –ª—É—á—à–µ–≥–æ!
    –Ø –æ—á–µ–Ω—å —Ä–∞–¥, —á—Ç–æ —Ç–µ–±—è –≤—Å—Ç—Ä–µ—Ç–∏–ª –≤ —Ç–æ–º –≥–æ–¥—É! –ò –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ —ç—Ç–∞ –¥—Ä—É–∂–±–∞ –ø—Ä–æ—Ç—è–Ω–µ—Ç—Å—è –µ—â–µ –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è!
    –Ø –æ—á–µ–Ω—å –¥–æ–ª–≥–æ –¥—É–º–∞–ª –Ω–∞–¥ —Ç–µ–º, –∫–∞–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —è —Ö–æ—Ç–µ–ª –ø–æ–º–æ—á—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –ø—É—Ç–µ–≤–∫–∏ –≤ –ò—Å–ø–∞–Ω–∏—é. –ê —ç—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ –≤–∏–∑–∏—Ç–∫–∞))))
    –ü–æ—Å–ª–µ —Ä–∞–∑—É–∑–Ω–∞–≤, –ø–æ–Ω—è–ª, —á—Ç–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –≤–∏–∑—ã, –¥–∞ –∏ —è –∫–∞–∫-–±—É–¥—Ç–æ –≤—ã–Ω—É–∂–¥–∞–ª —á–∞—Å—Ç—å –ª–µ—Ç–∞ —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ç–∞–∫. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ–¥–∞—Ä–æ–∫ –∏–∑–º–µ–Ω—è–ª—Å—è –∏ —É—Ö–æ–¥–∏–ª –æ—Ç —Ä–æ–ª–∏ –≤–∏–∑–∏—Ç–∫–∏.
    –Ø –Ω–∞—á–∞–ª –¥—É–º–∞—Ç—å –æ–± —Ñ–æ—Ä–º–∞—Ç–µ. –°–Ω–∞—á–∞–ª–∞ –≤—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å –≤ —Ü–≤–µ—Ç–∞—Ö —Ç–≤–æ–µ–≥–æ –æ—Ç—Ä—è–¥–∞, –Ω–æ –≤ –º–æ–º–µ–Ω—Ç–µ —è –ø–æ—Å—á–∏—Ç–∞–ª, —á—Ç–æ –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç –º–µ–Ω—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –Ω–µ –º–æ–µ–π –∏–Ω–¥–µ–Ω—Ç–∏–∫–∏ –±—ã–ª–æ –±—ã —á–µ–º-—Ç–æ –Ω–µ —Ç–µ–º.
    –ü–æ—Å–ª–µ –Ω–∞—à–µ–ª –∏–¥–µ–∏ —Å –∫–∞—Ä—É—Å–µ–ª—å—é –≤ –∫–æ—Å–º–æ—Å–µ –∏ –ø–æ–¥—É–º–∞–ª, —á—Ç–æ —ç—Ç–æ –±—ã–ª–æ –±—ã –∫—Ä—É—Ç–æ. 
    –Ø –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ –º–æ–∏ –ø–æ–¥–∞—Ä–∫–∏ –Ω–∏–∫–∞–∫ —Ç–µ–±—è –Ω–µ –æ–±–∏–¥–µ–ª–∏, –Ω–µ —Å–¥–µ–ª–∞–ª–∏ –±–æ–ª—å–Ω–æ –∏ —Ç–¥.
    –¢—ã –∑–Ω–∞–µ—à—å, —á—Ç–æ —è –æ—á–µ–Ω—å –º–Ω–æ–≥–æ —Å–∏–ª –ø–æ—Ç—Ä–∞—Ç–∏–ª –∏ —Ç–æ—á–Ω–æ –Ω–µ —Ö–æ—Ç–µ–ª –±—ã –∫–∞–∫-—Ç–æ –æ–±–∏–¥–µ—Ç—å —Ç–µ–±—è.
    –ù–∞–¥–µ—é—Å—å, —á—Ç–æ —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –∫–æ—Å–º–æ—Å—É –∏ —Ç—ã –Ω–µ –æ—Ç–∫–∞–∂–µ—à—å –º–Ω–µ –≤ –ø–µ—Ä–µ–¥–∞—á–µ —Ç–≤–æ–µ–≥–æ –ø–æ–¥–∞—Ä–∫–∞.

    
    –ò–Ω–æ–≥–¥–∞ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ –ø–æ–∂–µ–ª–∞—Ç—å —á–µ–ª–æ–≤–µ–∫—É —á—Ç–æ-—Ç–æ, –∫–æ–≥–¥–∞ —É –Ω–µ–≥–æ —É–∂–µ –≤—Å–µ –µ—Å—Ç—å. 
    –¢—ã, –¥—É–º–∞—é, –∑–Ω–∞–µ—à—å, —á—Ç–æ —è –∏ —Ç–∞–∫ –≤—Å–µ —Å–∏–ª—ã –æ—Ç–¥–∞—é –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã —Ç—ã –±—ã–ª–∞ —Å—á–∞—Å—Ç–ª–∏–≤–∞)
    –ú–Ω–µ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ –Ω—É–∂–µ–Ω –ø–æ–≤–æ–¥. –ù–æ —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Ç–µ–±–µ —á—Ç–æ-—Ç–æ –ø–æ–∂–µ–ª–∞—Ç—å.

    –ê –∂–µ–ª–∞—é —è —Ç–µ–±–µ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ, —á—Ç–æ —Ç—ã —Ç–∞–∫ –∂–µ–ª–∞–ª–∞ –≤ —Ç–æ–º –≥–æ–¥—É, –Ω–æ –Ω–µ —É—Å–ø–µ–ª–∞!

    –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –±–æ–ª—å—à–µ–≥–æ –º–Ω–µ –ø–æ–∂–µ–ª–∞—Ç—å –∏ —Å–∫–∞–∑–∞—Ç—å –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–π —Å—Ç–∞—Ç—É—Å)
    –ü–æ—ç—Ç–æ–º—É —è –æ—Å—Ç–∞–Ω–æ–≤–ª—é—Å—å –Ω–∞ —ç—Ç–æ–º.
    –ï—â–µ —Ä–∞–∑ —Å–ø–∞—Å–∏–±–æ —Ç–µ–±–µ –∑–∞ —Ç–µ–±—è –∏ –µ—â–µ —Ä–∞–∑ —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è!
    –ü—É—Å—Ç—å –ø—Ä–∏–±—É–¥–∏—Ç —Å —Ç–æ–±–æ–π —Å–∏–ª–∞! –ê–•–ê–•–ê–•–ê–•–ê–•–ê
  `

  return (
    <div className="finale-page">
      <Starfield speed={0.15} starColor="rgba(255,255,255,1)" quantity={2400} />
      
      <button 
        className="music-toggle"
        onClick={handleMusicToggle}
      >
        {musicPlaying ? 'üîá –í—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É' : 'üîä –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É'}
      </button>

      <div className={`crawl-container ${showText ? 'visible' : ''}`}>
        <div className="crawl-text">
          {congratulationText.split('\n').map((line, index) => (
            <p key={index}>{line}</p>
          ))}
        </div>
      </div>
    </div>
  )
}

export default Finale



